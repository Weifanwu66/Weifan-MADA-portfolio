{
  "hash": "6d0a683b79f995eccc29f2b5a677cac8",
  "result": {
    "markdown": "---\ntitle: \"Visualization Exercise\"\noutput:\n  html_document:\n    toc: FALSE\n---\n\n\nThe plot that I try to reproduce here is from [fivethirtyeight.com](https://fivethirtyeight.com/features/marriage-isnt-dead-yet/). The marriage isn't dead-yet. It depicts the divorce rates by education in the age group from 35 to 44\n\n![](images/5002a517b24e1a1c63c3ad92f026078.png)\n\nsetup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggtext)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   0.3.5 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at C:/Users/weifa/OneDrive/Documents/GitKraken/MADA/data analysis/Weifan-MADA-portfolio\n```\n:::\n:::\n\n\nimport data and glimpse data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndataLocation=here(\"marriage\",\"divorce.csv\")\nrawData=read.csv(dataLocation)\nglimpse(rawData)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 17\nColumns: 21\n$ X         <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17\n$ year      <int> 1960, 1970, 1980, 1990, 2000, 2001, 2002, 2003, 2004, 2005, …\n$ date      <chr> \"1960-01-01\", \"1970-01-01\", \"1980-01-01\", \"1990-01-01\", \"200…\n$ all_3544  <dbl> 0.03444454, 0.04925600, 0.10600503, 0.15080495, 0.15684099, …\n$ HS_3544   <dbl> 0.03488887, 0.04999984, 0.10415128, 0.15938095, 0.17544616, …\n$ SC_3544   <dbl> 0.03366938, 0.04870549, 0.11269947, 0.16967005, 0.17380324, …\n$ BAp_3544  <dbl> 0.02751277, 0.04125945, 0.09777208, 0.11495533, 0.10561772, …\n$ BAo_3544  <dbl> 0.02751277, 0.04125945, 0.09777208, 0.11853432, 0.11053969, …\n$ GD_3544   <dbl> NA, NA, NA, 0.10914537, 0.09590347, 0.09719692, 0.09076255, …\n$ poor_3544 <dbl> 0.07195136, 0.11373582, 0.24164705, 0.32694839, 0.34308859, …\n$ mid_3544  <dbl> 0.02122530, 0.03030104, 0.07367154, 0.11190969, 0.11658371, …\n$ rich_3544 <dbl> 0.02256233, 0.02192707, 0.03501521, 0.04972527, 0.04939497, …\n$ all_4554  <dbl> 0.03965056, 0.05062562, 0.08818511, 0.14572572, 0.17958060, …\n$ HS_4554   <dbl> 0.04007142, 0.05056576, 0.08566351, 0.14077914, 0.18477676, …\n$ SC_4554   <dbl> 0.03870331, 0.05147270, 0.09500947, 0.16633103, 0.20110350, …\n$ BAp_4554  <dbl> 0.03188568, 0.04831053, 0.09103488, 0.13436974, 0.14904161, …\n$ BAo_4554  <dbl> 0.03188568, 0.04831053, 0.09103488, 0.13566093, 0.15369313, …\n$ GD_4554   <dbl> NA, NA, NA, 0.1327413, 0.1425498, 0.1417453, 0.1367771, 0.14…\n$ poor_4554 <dbl> 0.07537252, 0.11249624, 0.19867321, 0.30661378, 0.38213542, …\n$ mid_4554  <dbl> 0.02933657, 0.03386947, 0.06300866, 0.11498064, 0.14224209, …\n$ rich_4554 <dbl> 0.02350489, 0.02123280, 0.02791567, 0.04577501, 0.05152510, …\n```\n:::\n:::\n\n\ndata wrangling\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#select the columns that contain the information that we need for plotting, which is year, HS_3544, SC_3544, and BAp_3544\nedu_div=rawData%>%\n  select(c(2,5:7))\n#reshape the dataset, combine all the educational levels under \"educational_level\" variable and their respective values under \"divorce\" variable\nedu_div1=edu_div%>%\n  gather(key=\"education_level\",value=\"divorce\",2:4)\nedu_div1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   year education_level    divorce\n1  1960         HS_3544 0.03488887\n2  1970         HS_3544 0.04999984\n3  1980         HS_3544 0.10415128\n4  1990         HS_3544 0.15938095\n5  2000         HS_3544 0.17544616\n6  2001         HS_3544 0.17411604\n7  2002         HS_3544 0.17476931\n8  2003         HS_3544 0.17254483\n9  2004         HS_3544 0.17756455\n10 2005         HS_3544 0.17516353\n11 2006         HS_3544 0.18943673\n12 2007         HS_3544 0.18721641\n13 2008         HS_3544 0.18837663\n14 2009         HS_3544 0.18698758\n15 2010         HS_3544 0.18989580\n16 2011         HS_3544 0.19239892\n17 2012         HS_3544 0.19020633\n18 1960         SC_3544 0.03366938\n19 1970         SC_3544 0.04870549\n20 1980         SC_3544 0.11269947\n21 1990         SC_3544 0.16967005\n22 2000         SC_3544 0.17380324\n23 2001         SC_3544 0.17816906\n24 2002         SC_3544 0.17929419\n25 2003         SC_3544 0.17697536\n26 2004         SC_3544 0.17707955\n27 2005         SC_3544 0.17674265\n28 2006         SC_3544 0.18412098\n29 2007         SC_3544 0.18496086\n30 2008         SC_3544 0.18944998\n31 2009         SC_3544 0.19013626\n32 2010         SC_3544 0.19726945\n33 2011         SC_3544 0.20045883\n34 2012         SC_3544 0.20317649\n35 1960        BAp_3544 0.02751277\n36 1970        BAp_3544 0.04125945\n37 1980        BAp_3544 0.09777208\n38 1990        BAp_3544 0.11495533\n39 2000        BAp_3544 0.10561772\n40 2001        BAp_3544 0.10703886\n41 2002        BAp_3544 0.10344219\n42 2003        BAp_3544 0.10254990\n43 2004        BAp_3544 0.10033665\n44 2005        BAp_3544 0.09948066\n45 2006        BAp_3544 0.10383550\n46 2007        BAp_3544 0.10392942\n47 2008        BAp_3544 0.10201919\n48 2009        BAp_3544 0.10194261\n49 2010        BAp_3544 0.10306385\n50 2011        BAp_3544 0.10776053\n51 2012        BAp_3544 0.10740666\n```\n:::\n\n```{.r .cell-code}\n#remove strings \"_3544\" since we have already chosen the age groups beforehand, recode the levels to make table more intuitive, And mutate divorce rate to percentage\nedu_div2=edu_div1%>%\n  mutate(education_level=str_replace(string=education_level,pattern=\"_3544\",replacement=\"\"))%>%\n  mutate(education_level=recode(education_level,\"HS\"=\"High school or less\",\"SC\"=\"Some college\", \"BAp\"=\"College graduates\"))%>%\n  mutate(divorce=divorce*100)\nedu_div2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   year     education_level   divorce\n1  1960 High school or less  3.488887\n2  1970 High school or less  4.999984\n3  1980 High school or less 10.415128\n4  1990 High school or less 15.938095\n5  2000 High school or less 17.544616\n6  2001 High school or less 17.411604\n7  2002 High school or less 17.476931\n8  2003 High school or less 17.254483\n9  2004 High school or less 17.756455\n10 2005 High school or less 17.516353\n11 2006 High school or less 18.943673\n12 2007 High school or less 18.721641\n13 2008 High school or less 18.837663\n14 2009 High school or less 18.698758\n15 2010 High school or less 18.989580\n16 2011 High school or less 19.239892\n17 2012 High school or less 19.020633\n18 1960        Some college  3.366938\n19 1970        Some college  4.870549\n20 1980        Some college 11.269947\n21 1990        Some college 16.967005\n22 2000        Some college 17.380324\n23 2001        Some college 17.816906\n24 2002        Some college 17.929419\n25 2003        Some college 17.697536\n26 2004        Some college 17.707955\n27 2005        Some college 17.674265\n28 2006        Some college 18.412098\n29 2007        Some college 18.496086\n30 2008        Some college 18.944998\n31 2009        Some college 19.013626\n32 2010        Some college 19.726945\n33 2011        Some college 20.045883\n34 2012        Some college 20.317649\n35 1960   College graduates  2.751277\n36 1970   College graduates  4.125945\n37 1980   College graduates  9.777208\n38 1990   College graduates 11.495533\n39 2000   College graduates 10.561772\n40 2001   College graduates 10.703886\n41 2002   College graduates 10.344219\n42 2003   College graduates 10.254990\n43 2004   College graduates 10.033665\n44 2005   College graduates  9.948066\n45 2006   College graduates 10.383550\n46 2007   College graduates 10.392942\n47 2008   College graduates 10.201919\n48 2009   College graduates 10.194261\n49 2010   College graduates 10.306385\n50 2011   College graduates 10.776053\n51 2012   College graduates 10.740666\n```\n:::\n:::\n\n\nPlotting\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#creating a data frame that will be used for plotting the names of education levels, I eventually used annotation function to create my graph, but I still want to leave this section here\neducation_level_labels=edu_div2%>%\n  pivot_wider(names_from=\"year\",values_from=\"divorce\")%>%\n  mutate(nrow=1:n(), #create a new column indicating which row each education level is at\n         year=if_else(nrow%%2==0,\"1990\",\"1980\"),#modulus function %% tells you the remainder, if the row is a even number (some college), we will take 1994,otherwise take 1985\n         divorce=if_else(nrow%%2==0,`1990`,`1980`))%>% \n  select(education_level,year,divorce)\neducation_level_labels%>%\n  mutate(year=as.numeric(year))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 3\n  education_level      year divorce\n  <chr>               <dbl>   <dbl>\n1 High school or less  1980   10.4 \n2 Some college         1990   17.0 \n3 College graduates    1980    9.78\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#using geom_line\nplot1=edu_div2%>%\nggplot(aes(x=year,y=divorce,group=education_level,color=education_level))+\n  geom_line(linewidth=1.5,show.legend=FALSE)+\n  #geom_text(data=education_level_labels,aes(group=1,label=education_level),show.legend=FALSE)+\n  labs(title=\"Divorce Rates By \nEducation\",\n       subtitle=\"Ages 35 to 44\",\n       x=NULL,y=NULL)+\n  scale_x_continuous(breaks=seq(1960,2012,by=10),labels=c(\"1960\",\"'70\",\"'80\",\"'90\",\"2000\",\"'10\"),minor_breaks=NULL)+\n  scale_y_continuous(breaks=seq(0,25,by=5),labels=c(\"0\",\"5\",\"10\",\"15\",\"20\",\"25%\"),minor_breaks=NULL)+\n  scale_color_manual(breaks=c(\"High school or less\",\"Some College\",\"College graduates\"),values=c(\"#6699CC\",\"#0047AB\",\"#89CFF0\"))+\n  theme(\n        text=element_text(size=16),\n        plot.title=element_textbox_simple(size=14,face=\"bold\"),#control the size of title and subtitle\n        plot.subtitle=element_textbox_simple(size=12),\n        plot.background = element_rect(fill=\"#ededed\"),#change the whole plot background color\n        panel.background=element_rect(fill=\"#ededed\"),#change the panel background color\n        panel.grid.major = element_line(color=\"lightgrey\"), #change the grid color in the panel background\n        legend.position=\"none\",\n        axis.text=element_text(size=12), #specify the text size\n        axis.ticks=element_blank()       #remove all the ticks\n        )+\n  geom_hline(yintercept = 0)+ #highlight the x axis (when y=0)\n  annotate(\"text\",x=1995, y=7,label=\"High school or less\")+ #using annotate functions to add text and lines in the graph\n  annotate(\"text\",x=1995,y=22,label=\"Some college\")+\n  annotate(\"text\",x=2005,y=14,label=\"College graduate\")+\n  annotate(\"segment\",x=1990,xend=1990,y=7,yend=16,color=\"black\",size=0.7)+\n  annotate(\"segment\",x=1995,xend=1995,y=21,yend=17,color=\"black\",size=0.7)+\n  annotate(\"segment\",x=2005,xend=2005,y=13,yend=10,color=\"black\",size=0.7)+\n  coord_fixed(ratio=2, ylim=c(0,25),xlim=c(1960,2012))    #control the ratio of y/x coordinate, but also specify the limits for y&x axis in case this function overwrite the axis range\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n:::\n\n```{.r .cell-code}\nplot1\n```\n\n::: {.cell-output-display}\n![](visualization_exercise_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nmodify the graph using geom_point to indicate the data density, obviously more data was collected from year 2000-2010\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot2=edu_div2%>%\nggplot(aes(x=year,y=divorce,group=education_level,color=education_level))+\n  geom_point(size=3,alpha=0.7)+\n  geom_line(linewidth=1.5,show.legend=FALSE)+\n  labs(title=\"Divorce Rates By \nEducation\",\n       subtitle=\"Ages 35 to 44\",\n       x=NULL,y=NULL)+\n  scale_x_continuous(breaks=seq(1960,2012,by=10),labels=c(\"1960\",\"'70\",\"'80\",\"'90\",\"2000\",\"'10\"),minor_breaks=NULL)+\n  scale_y_continuous(breaks=seq(0,25,by=5),labels=c(\"0\",\"5\",\"10\",\"15\",\"20\",\"25%\"),minor_breaks=NULL)+\n  scale_color_manual(breaks=c(\"High school or less\",\"Some College\",\"College graduates\"),values=c(\"#6699CC\",\"#0047AB\",\"#89CFF0\"))+\n  theme(\n        text=element_text(size=16),\n        plot.title=element_textbox_simple(size=14,face=\"bold\"),#control the size of title and subtitle\n        plot.subtitle=element_textbox_simple(size=12),\n        plot.background = element_rect(fill=\"#ededed\"),#change the whole plot background color\n        panel.background=element_rect(fill=\"#ededed\"),#change the panel background color\n        panel.grid.major = element_line(color=\"lightgrey\"), #change the grid color in the panel background\n        legend.position=\"none\",\n        axis.text=element_text(size=12), #specify the text size\n        axis.ticks=element_blank()       #remove all the ticks\n        )+\n  geom_hline(yintercept = 0)+ #highlight the x axis (when y=0)\n  annotate(\"text\",x=1995, y=7,label=\"High school or less\")+ #using annotate functions to add text and lines in the graph\n  annotate(\"text\",x=1995,y=22,label=\"Some college\")+\n  annotate(\"text\",x=2005,y=14,label=\"College graduate\")+\n  annotate(\"segment\",x=1990,xend=1990,y=7,yend=16,color=\"black\",size=0.7)+\n  annotate(\"segment\",x=1995,xend=1995,y=21,yend=17,color=\"black\",size=0.7)+\n  annotate(\"segment\",x=2005,xend=2005,y=13,yend=10,color=\"black\",size=0.7)+\n  coord_fixed(ratio=2, ylim=c(0,25),xlim=c(1960,2012))    #control the ratio of y/x coordinate, but also specify the limits for y&x axis in case this function overwrite the axis range\nplot2\n```\n\n::: {.cell-output-display}\n![](visualization_exercise_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nsave the plot\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"plot1.pdf\",width=8,height=8,units=\"cm\")\n```\n:::\n",
    "supporting": [
      "visualization_exercise_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}